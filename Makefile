# –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä
CXX = g++

# –§–ª–∞–≥–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞
CXXFLAGS = -Wall -Wextra -I./headers

# –ü—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º
SRC_DIR = src
TEST_DIR = tests

# –§–∞–π–ª—ã –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ –∏ —Ç–µ—Å—Ç–æ–≤
SRCS = $(wildcard $(SRC_DIR)/*.cpp)
TEST_SRCS = $(wildcard $(TEST_DIR)/*.cpp)

# –¶–µ–ª–µ–≤—ã–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã
TARGET = home
TEST_TARGET = test_home

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN=\033[0;32m
RED=\033[0;31m
NC=\033[0m # –ë–µ–∑ —Ü–≤–µ—Ç–∞

# –ü—Ä–∞–≤–∏–ª–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
all: $(TARGET)

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
$(TARGET): $(SRCS)
	@echo "üîß –ö–æ–º–ø–∏–ª—è—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
	$(CXX) $(CXXFLAGS) $^ -o $@
	@echo "$(GREEN)‚úÖ –°–æ–±—Ä–∞–Ω–æ: $(TARGET)$(NC)"

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
test: $(TEST_TARGET)
	@echo "üîç –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
	@./$(TEST_TARGET) && \
	echo "$(GREEN)‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!$(NC)" || \
	(echo "$(RED)‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏!$(NC)"; exit 1)

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
$(TEST_TARGET): $(SRCS) $(TEST_SRCS)
	@echo "üß™ –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤..."
	$(CXX) $(CXXFLAGS) $^ -lgtest -lgtest_main -pthread -o $@
	@echo "$(GREEN)‚úÖ –°–æ–±—Ä–∞–Ω–æ: $(TEST_TARGET)$(NC)"

# –û—á–∏—Å—Ç–∫–∞
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞..."
	@rm -f $(TARGET) $(TEST_TARGET)
	@echo "$(GREEN)‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞$(NC)"

.PHONY: all clean test